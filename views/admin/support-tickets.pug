html
  head
    title Admin Support Tickets - AliasZap
    link(href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css', rel='stylesheet')
    link(href='/css/styles.css', rel='stylesheet')
  body
    nav.navbar.navbar-expand-lg.navbar-light.bg-light
      .container
        a.navbar-brand(href='/') AliasZap
        button.navbar-toggler(type='button', data-bs-toggle='collapse', data-bs-target='#navbarNav')
          span.navbar-toggler-icon
        #navbarNav.collapse.navbar-collapse
          ul.navbar-nav.ms-auto
            li.nav-item
              a.nav-link(href='/dashboard') Dashboard
            if user.plan !== 'free'
              li.nav-item
                a.nav-link(href='/custom-domains') Custom Domains
            li.nav-item
              a.nav-link(href='/subscribe') Upgrade
            li.nav-item
              a.nav-link(href='/support') Support
            li.nav-item
              a.nav-link(href='/logout') Logout
            li.nav-item
              button#darkModeToggle.btn.btn-link.nav-link Dark Mode
    .container.mt-5
      .row
        .col-md-10.offset-md-1
          h2.mb-4 Admin Support Tickets
          if error
            .alert.alert-danger= error
          if success
            .alert.alert-success= success
          if tickets && tickets.length > 0
            .table-responsive.mt-4
              table.table.table-striped
                thead
                  tr
                    th Ticket ID
                    th User Email
                    th Subject
                    th Priority
                    th Status
                    th Created
                    th Message
                    th Action
                tbody
                  each ticket in tickets
                    tr
                      td= ticket._id
                      td= ticket.userId ? ticket.userId.email : 'N/A'
                      td= ticket.subject
                      td= ticket.priority ? 'Yes' : 'No'
                      td= ticket.status
                      td= ticket.createdAt ? new Date(ticket.createdAt).toDateString() : 'N/A'
                      td= ticket.message
                      td
                        if ticket.status === 'open'
                          form(action=`/admin/support-tickets/close/${ticket._id}`, method='POST', style='display:inline')
                            input(type='hidden', name='_csrf', value=csrfToken)
                            button.btn.btn-warning.btn-sm(type='submit') Close
                          form(action=`/admin/support-tickets/respond/${ticket._id}`, method='POST', style='display:inline; margin-left: 5px')
                            input(type='hidden', name='_csrf', value=csrfToken)
                            .input-group
                              input.form-control(type='text', name='response', placeholder='Respond to ticket', required)
                              button.btn.btn-primary.btn-sm(type='submit') Respond
          else
            p.text-muted No support tickets found.